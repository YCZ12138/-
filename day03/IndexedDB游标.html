<!--
 * @Description: è·å–å¤šæ¡æ•°æ®
 * @Author: rendc
 * @Date: 2022-06-27 11:21:02
 * @LastEditors: rendc
 * @LastEditTime: 2022-06-27 11:33:11
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IndexedDB</title>
</head>

<body>
  IndexedDBå­¦ä¹ 
</body>
<script>
  let db, request, version = 2;
  request = indexedDB.open("admin", version);
  request.onupgradeneeded = (e) => {
    // onupgradeneededä¸ä¼šåœ¨åˆ·æ–°é¡µé¢æ—¶æ‰§è¡Œ è€Œæ˜¯åœ¨åˆ·æ–°é¡µé¢æ—¶å‘ç°versionè¢«å‡çº§äº†æ‰æ‰§è¡Œ
    db = e.target.result
    // åˆ›å»ºä¹‹å‰å…ˆåˆ¤æ–­æ˜¯å¦æœ‰åŒåstore
    if (!db.objectStoreNames.contains('myStore')) {
      // åˆ›å»ºobjectStore
      db.createObjectStore('myStore', {
        keyPath: 'id'
      })
    }
  }
  request.onerror = (e) => {
    console.log(`æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯ç ï¼š${e.target.error.code}`);
    console.log(`æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯åç§°ï¼š${e.target.error.name}`);
    console.log(`æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯åŸå› ï¼š${e.target.error.message}`);
  }
  request.onsuccess = (e) => {
    console.log(`æ•°æ®åº“åˆ›å»º/æ‰“å¼€æˆåŠŸ`);
    db = e.target.result; // è·å–æ•°æ®åº“å¯¹è±¡å®¹å™¨
    // äº‹åŠ¡
    let transaction = db.transaction('myStore', 'readwrite');
    const store = transaction.objectStore('myStore')
    const users = [{
        id: 1,
        name: "tom"
      },
      {
        id: 2,
        name: "terry"
      },
      {
        id: 3,
        name: "larry"
      }
    ];
    for (const user of users) {
      // request = store.add(user); // æ–°å¢æ•°æ®
      request = store.put(user); // æ–°å¢æ•°æ®
      request.onerror = (e) => {
        console.error('ğŸ¤¡ CC - onerror - e', e.target.error)
      };
      request.onsuccess = (e) => {
        // console.log('ğŸ¤¡ CC - onsuccess - e', e)
      };
    }
    // è·å–å¤šæ¡æ•°æ®
    // åˆ›å»ºæ¸¸æ ‡
    request = store.openCursor();
    request.onsuccess = (e) => {
      const cursor = e.target.result;
      if (cursor) {
        console.log(`é”®ï¼š${cursor.key},å€¼ï¼š${JSON.stringify(cursor.value)},`);
        // ç§»åŠ¨åˆ°ä¸‹ä¸€æ¡è®°å½•
        cursor.continue();
      } else {
        console.log(`æ•°æ®å±•ç¤ºå®Œæ¯•`);
      }
    };
  }
</script>

</html>