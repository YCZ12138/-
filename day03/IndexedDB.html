<!--
 * @Description: IndexedDB
 * @Author: rendc
 * @Date: 2022-06-27 09:30:08
 * @LastEditors: rendc
 * @LastEditTime: 2022-06-27 11:20:59
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IndexedDB</title>
</head>

<body>
  IndexedDBå­¦ä¹ 
</body>
<script>
  let db, request, version = 2;
  request = indexedDB.open("admin", version);
  request.onupgradeneeded = (e) => {
    // onupgradeneededä¸ä¼šåœ¨åˆ·æ–°é¡µé¢æ—¶æ‰§è¡Œ è€Œæ˜¯åœ¨åˆ·æ–°é¡µé¢æ—¶å‘ç°versionè¢«å‡çº§äº†æ‰æ‰§è¡Œ
    db = e.target.result
    // åˆ›å»ºä¹‹å‰å…ˆåˆ¤æ–­æ˜¯å¦æœ‰åŒåstore
    if (!db.objectStoreNames.contains('myStore')) {
      // åˆ›å»ºobjectStore
      db.createObjectStore('myStore', {
        keyPath: 'id'
      })
    }
  }
  request.onerror = (e) => {
    console.log(`æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯ç ï¼š${e.target.error.code}`);
    console.log(`æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯åç§°ï¼š${e.target.error.name}`);
    console.log(`æ•°æ®åº“æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯åŸå› ï¼š${e.target.error.message}`);
  }
  request.onsuccess = (e) => {
    console.log(`æ•°æ®åº“åˆ›å»º/æ‰“å¼€æˆåŠŸ`);
    db = e.target.result; // è·å–æ•°æ®åº“å¯¹è±¡å®¹å™¨
    console.log('ğŸ¤¡ CC - db', db)
    // äº‹åŠ¡
    let transaction = db.transaction('myStore', 'readwrite');
    const store = transaction.objectStore('myStore')
    const users = [{
        id: 1,
        name: "tom"
      },
      {
        id: 2,
        name: "terry"
      },
      {
        id: 3,
        name: "larry"
      }
    ];
    for (const user of users) {
      // request = store.add(user); // æ–°å¢æ•°æ®
      // request = store.put(user); // æ–°å¢æ•°æ®
      request.onerror = (e) => {
        console.error('ğŸ¤¡ CC - onerror - e', e.target.error)
      };
      request.onsuccess = (e) => {
        console.log('ğŸ¤¡ CC - onsuccess - e', e)
      };
    }
    // æ›´æ–°æ•°æ®
    request = store.put({
      id: 3,
      name: "newLarry"
    });
    // åˆ é™¤æ•°æ®
    // request = store.delete(2);
    request.onerror = (e) => {
      console.error('ğŸ¤¡ CC - onerror - e', e.target.error)
    };
    request.onsuccess = (e) => {
      console.log('ğŸ¤¡ CC - onsuccess - e', e)
    };
    // è·å–æ•°æ®
    request = store.get(1);
    request.onsuccess = (e) => {
      console.log('æŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯:');
      console.log(e.target.result);
    };
    // è·å–å¤šæ¡æ•°æ®
    request.onsuccess = (e) => {
      console.log('æŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯:');
      console.log(e.target.result);
    };
  }
</script>

</html>